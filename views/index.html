<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Portfolio Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-50 text-gray-900 font-sans min-h-screen overflow-auto">
    <div class="grid grid-cols-3 gap-6 p-8 max-w-7xl mx-auto">

        <!-- LEFT PANEL -->
        <div class="bg-white p-6 rounded-2xl shadow-xl space-y-8 border border-gray-200">
            <!-- Net Worth -->
            <div>
                <h2 class="text-xs font-medium text-gray-500 uppercase tracking-wide">Net Worth</h2>
                <p class="text-2xl font-semibold text-gray-900 mt-1">$2,317,371.20</p>
            </div>

            <!-- Cash Section -->
            <div>
                <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wide border-b pb-2">Cash</h3>
                <div class="mt-4 space-y-3 text-sm">
                    <div>
                        <p class="font-medium">Fidelity Cash</p>
                        <div class="flex justify-between text-gray-500">
                            <span>$2,291.90</span><span>13 mins ago</span>
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">Wells Fargo (Checking)</p>
                        <div class="flex justify-between text-gray-500">
                            <span>$309.13</span><span>13 mins ago</span>
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">Wells Fargo (Savings)</p>
                        <div class="flex justify-between text-gray-500">
                            <span>$2,000.67</span><span>13 mins ago</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Investment Section -->
            <div>
                <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wide border-b pb-2">Investment</h3>
                <div class="mt-4 space-y-3 text-sm">
                    <div>
                        <p class="font-medium">Beneke Fabricators</p>
                        <div class="flex justify-between text-gray-500">
                            <span>$16,231.00 (12 shares)</span><span>13 mins ago</span>
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">Fidelity Brokerage</p>
                        <div class="flex justify-between text-gray-500">
                            <span>$53,165.79 (30 shares)</span><span>13 mins ago</span>
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">Pershing (IRA 1)</p>
                        <div class="flex justify-between text-gray-500">
                            <span>$456,191.03 (60 shares)</span><span>13 mins ago</span>
                        </div>
                    </div>
                    <div>
                        <p class="font-medium">Stock Options - Pandora</p>
                        <div class="flex justify-between text-gray-500">
                            <span>$31,715.00 (5 shares)</span><span>13 mins ago</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MIDDLE PANEL -->
        <div class="bg-white p-6 rounded-2xl shadow-xl flex flex-col justify-between border border-gray-200">
            <!-- Net Worth Chart with Summary -->
            <div class="mb-10">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xs font-medium text-gray-500 uppercase tracking-wide">Net Worth</h2>
                    <div class="text-right">
                        <p id="networth-today" class="text-2xl font-semibold text-gray-900">$0</p>
                        <p id="networth-change" class="text-sm">+ $0 (1 Day)</p>
                    </div>
                </div>
                <div
                    class="w-full h-72 bg-gray-50 rounded-xl p-4 border border-dashed flex items-center justify-center">
                    <canvas id="netWorthChart" class="w-full h-full max-w-3xl"></canvas>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL -->
        <div class="bg-white p-6 rounded-2xl shadow-xl space-y-8 border border-gray-200">
            <!-- Holdings styled like stock apps with scroll -->
            <div>
                <h2 class="text-xs font-medium text-gray-500 uppercase tracking-wide mb-3">Current Holdings</h2>
                <ul class="text-sm divide-y divide-gray-100 max-h-48 overflow-y-auto pr-2">
                    <li class="py-3">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-gray-800">Beneke Fabricators</span>
                            <span class="text-green-600 font-semibold">+4.5%</span>
                        </div>
                        <div class="text-xs text-gray-500">12 shares</div>
                    </li>
                    <li class="py-3">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-gray-800">Fidelity Brokerage</span>
                            <span class="text-red-600 font-semibold">-2.1%</span>
                        </div>
                        <div class="text-xs text-gray-500">30 shares</div>
                    </li>
                    <li class="py-3">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-gray-800">Pershing (IRA 1)</span>
                            <span class="text-green-600 font-semibold">+1.8%</span>
                        </div>
                        <div class="text-xs text-gray-500">60 shares</div>
                    </li>
                    <li class="py-3">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-gray-800">Stock Options - Pandora</span>
                            <span class="text-red-600 font-semibold">-0.9%</span>
                        </div>
                        <div class="text-xs text-gray-500">5 shares</div>
                    </li>
                    <li class="py-3">
                        <div class="flex justify-between items-center">
                            <span class="font-medium text-gray-800">Apple Inc.</span>
                            <span class="text-green-600 font-semibold">+2.7%</span>
                        </div>
                        <div class="text-xs text-gray-500">10 shares</div>
                    </li>
                </ul>
            </div>

            <!-- Buy Form -->
            <form id="buyForm" class="space-y-3">
                <h3 class="font-semibold text-sm text-gray-700">➕ Buy Stock</h3>
                <input type="text" id="buySymbol" placeholder="Symbol (e.g. AAPL)"
                    class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required>
                <input type="number" id="buyAmount" placeholder="Shares (e.g. 10)" min="1"
                    class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required>
                <button
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg w-full text-sm font-semibold">Buy</button>
            </form>

            <!-- Sell Form -->
            <form id="sellForm" class="space-y-3">
                <h3 class="font-semibold text-sm text-gray-700">➖ Sell Stock</h3>
                <input type="text" id="sellSymbol" placeholder="Symbol (e.g. AAPL)"
                    class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500"
                    required>
                <input type="number" id="sellAmount" placeholder="Shares (e.g. 5)" min="1"
                    class="w-full border border-gray-300 px-3 py-2 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-red-500"
                    required>
                <button
                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg w-full text-sm font-semibold">Sell</button>
            </form>
        </div>
    </div>

    <!-- Chart Scripts -->
    <script>
        // Mock backend data from June 29 to July 28
        const backendData = [];
        const startDate = new Date("2025-06-29");

        for (let i = 0; i < 30; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);
            const netWorth = 2300000 + i * 300 + Math.random() * 200 - 100;
            backendData.push({
                date: date.toISOString().split('T')[0],
                net_worth: parseFloat(netWorth.toFixed(2))
            });
        }

        const labels = backendData.map(item => {
            const date = new Date(item.date);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        });

        const netWorthValues = backendData.map(item => item.net_worth);

        const latestNetWorth = netWorthValues[netWorthValues.length - 1];
        const previousNetWorth = netWorthValues[netWorthValues.length - 2];
        const difference = latestNetWorth - previousNetWorth;

        const formattedToday = '$' + latestNetWorth.toLocaleString(undefined, { maximumFractionDigits: 2 });
        const formattedDiff = (difference >= 0 ? '+ $' : '- $') +
            Math.abs(difference).toLocaleString(undefined, { maximumFractionDigits: 2 });

        document.addEventListener("DOMContentLoaded", async () => {
            const response = await fetch('/api/networth');
            const backendData = await response.json();

            const labels = backendData.map(item => {
                const date = new Date(item.date);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            const netWorthValues = backendData.map(item => item.net_worth);

            const latestNetWorth = netWorthValues[netWorthValues.length - 1];
            const previousNetWorth = netWorthValues[netWorthValues.length - 2];
            const difference = latestNetWorth - previousNetWorth;

            const formattedToday = '$' + latestNetWorth.toLocaleString(undefined, { maximumFractionDigits: 2 });
            const formattedDiff = (difference >= 0 ? '+ $' : '- $') +
                Math.abs(difference).toLocaleString(undefined, { maximumFractionDigits: 2 });

            document.getElementById('networth-today').textContent = formattedToday;
            const changeElem = document.getElementById('networth-change');
            changeElem.textContent = `${formattedDiff} (1 Day)`;
            changeElem.classList.add(difference >= 0 ? 'text-green-500' : 'text-red-500');

            // 渲染图表
            const ctx = document.getElementById('netWorthChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Net Worth ($)',
                        data: netWorthValues,
                        fill: true,
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3,
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    plugins: {
                        legend: { display: false },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        x: {
                            ticks: { maxTicksLimit: 6, color: '#6B7280' },
                            grid: { display: false }
                        },
                        y: {
                            ticks: {
                                callback: value => `$${(value / 1000).toFixed(0)}k`,
                                color: '#6B7280'
                            },
                            grid: {
                                color: '#E5E7EB',
                                drawBorder: false
                            }
                        }
                    }
                }
            });
        });


    </script>
</body>

</html>